\documentclass[11pt]{beamer}
%\usetheme{Amsterdam}
\usetheme{Darmstadt}
%\usecolortheme{beaver}

%Include all packages
%\ProvidesPackage{./tex/mySlideShowStyle}
%Packages pour les langues
\usepackage[utf8]{inputenc}
\usepackage[frenchb]{babel}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage{lmodern}
\usepackage{multimedia}

%Package pour la mise en forme
\usepackage{parallel}
\usepackage{setspace}
\usepackage{wrapfig}

%Packages pour les liens dynamiques
\usepackage{hyperref}
\usepackage{multicol}
%\usepackage{underscore}

%Packages pour les formules de Maths
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage{mathabx}
\usepackage{pseudocode}
\usepackage{fancybox}

%Packages des images
\usepackage{graphicx}
%\usepackage{subfigure}
\usepackage{subfig}
\usepackage{wrapfig}
\usepackage{caption}
%\usepackage{subcaption}

%Packages pour les string
\usepackage{xstring}

%Packages pour les listes
%\usepackage{enumitem}
\usepackage{moreverb}



%%%%%%%%%%%%%%%%%
\author{Nuno Guedelha}
\title{Implémentation et application d'un algorithme de Dynamique Hybride}
%\setbeamercovered{transparent} 
%\setbeamertemplate{navigation symbols}{} 
%\logo{} 
\institute{LAAS-CNRS}
\date{} 
%\subject{} 

\setbeamertemplate{footline}{
\leavevmode%
\hbox{\hspace*{-0.06cm}
\begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
	\usebeamerfont{author in head/foot}\insertshortauthor%~~(\insertshortinstitute)
\end{beamercolorbox}%
\begin{beamercolorbox}[wd=.55\paperwidth,ht=2.25ex,dp=1ex,center]{section in head/foot}%
	\usebeamerfont{section in head/foot}\insertshorttitle
\end{beamercolorbox}%
\begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,right]{section in head/foot}%
	\usebeamerfont{section in head/foot}\insertshortdate{}\hspace*{2em}
	\insertframenumber{} / \inserttotalframenumber\hspace*{2ex}
\end{beamercolorbox}}%
\vskip0pt%
}

\begin{document}


%==========================================================
\input{./tex/macros.tex}
%==========================================================

\begin{frame}
\titlepage
\end{frame}
%==========================================================

\begin{frame}{Plan}
\tableofcontents[part=01]
\tableofcontents[part=02]
\end{frame}
%==========================================================

\part{}

\section{Introduction}

\begin{frame}
  \frametitle{Contexte du stage}
  \framesubtitle{}
  \begin{block}{Projet professionnel}
  \begin{itemize}
    \item première expérience dans l'embarqué et le temps réel
    \item nouveau cap: la robotique mobile et le Master 2 IRR
    \item Objectif: chercheur en Robotique (entreprise ou laboratoire)
  \end{itemize}
  \end{block}
  \begin{block}{Le LAAS et Gepetto}
  \begin{itemize}
    \item Gepetto: expertise en analyse, génération de mouvements  
    \item Approche fondamentale, modélisation dynamique, contrôle, planification de mouvements
    \item {Intégration dans des packages open source \\
          $\hookrightarrow$ metapod: librairie de modélisation dynamique}
    \note{}
  \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Objectifs}
  \framesubtitle{}
\end{frame}
%==========================================================

\section{Modélisation Dynamique}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}

%==========================================================

\section{Contraintes en performances}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}

%==========================================================

\section{Formalisme: l'Algèbre Spatiale}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}

%==========================================================

\part{}
\section{L'algorithme de Dynamique Hybride}

\subsection{Principes et implémentation}

\begin{frame}
  \frametitle{Etat initial de metapod et besoins}
 
  Algorithmes déjà implémentés:
  \begin{itemize}
  \item Dynamique inverse:	"Recursive Newton-Euler Algorithm"
  \item Dynamique directe:	"Composite-Rigid-Body Algorithm"
  \end{itemize}
  \bigskip
  Algorithmes à implémenter et intégrer à la Dynamique Hybride:
  \begin{itemize}
  \item Calcul optimisé de $H$
  \item Dynamique directe:	résolution de $H \boldsymbol{\ddot{q} = \tau - C}$
  \item Dynamique inverse différentielle: $\mathrm{ID}_{\delta}(\boldsymbol{\ddot{q}}) = \mathrm{ID}(\boldsymbol{\ddot{q}}) - \mathrm{ID}(0)$
  \end{itemize}
  
\end{frame}

\begin{frame}

  \frametitle{Equation de mouvement}
  
  \begin{block}{équation de mouvement d'un arbre cinématique:}
  \begin{equation} \label{equ_equationMvt}
	H\bsy{(q) \ddot{q} + C(q,\dot{q},f^{ext}) = \tau}
	\end{equation}
  \end{block}
  
  \begin{description}
    \item[$\bsy{q, \dot{q}, \ddot{q}}$ :] vecteurs de position, vitesse, accélération
    \item[$\bsy{\tau}$ :] forces/couples moteurs (internes)
    \item[$\bsy{H}$ :] matrice des termes inertiels
    \item[$\bsy{C}$ :] forces de précontrainte extérieures
  \end{description}
  
  \note{pour chaque articulation $i$ on connaît soit le couple soit l'accélération}
  \begin{equation*}
  q_i
  \begin{cases}
  \text{articulation $fd$ "forward dynamics"}: &\tau_i \text{ connu} \\
  \text{articulation $id$ "inverse dynamics"}: &\ddot{q}_i \text{ connu}
  \end{cases}
  \end{equation*}
  
  ordre par défaut de $q_i$ dans $\boldsymbol{q}$:
  $\hookrightarrow$ suivant parcours DFS
  
  \note{ordre pour tous les algorithmes}

\end{frame}

\begin{frame}

  \frametitle{Permutation des vecteurs et coefficients...}
  \setmyFiguresFile{hybridDynamics4etapes}
  \begin{columns}[T]
    \begin{column}{.7\textwidth}\small
	  \begin{align*}
		\ddot{q} &= 
		\begin{bmatrix}
		  \ddot{q}_1 & \ddot{q}_2 & \textcolor{red}{\ddot{q}_4} & \ddot{q}_5 & \textcolor{red}{\ddot{q}_3} & \ddot{q}_6 & \ddot{q}_7
		\end{bmatrix}^T \\
		Q \ddot{q} &= 
		\begin{bmatrix}
		  \textcolor{red}{\ddot{q}_4} & \textcolor{red}{\ddot{q}_3} & \ddot{q}_1 & \ddot{q}_2 & \ddot{q}_5 & \ddot{q}_6 & \ddot{q}_7
		\end{bmatrix}
		=
		\begin{bmatrix}
		  \underline{\ddot{q}_1} \\
		  \underline{\ddot{q}_2}
		\end{bmatrix} \\
		\textnormal{ et } &\textnormal{de même } \\
		Q \tau &= 
		\begin{bmatrix}
		  \underline{\tau_1} \\
		  \underline{\tau_2}
		\end{bmatrix}
		\: , \:
		Q C = 
		\begin{bmatrix}
		  C_1 \\
		  C_2
		\end{bmatrix}
		\: , \: Q H Q^T = 
		\begin{bmatrix}
		  H_{11} & H_{12} \\
		  H_{21} & H_{22}
		\end{bmatrix} 
		\end{align*}
  \end{column}%
  \hfill%
  \begin{column}{.3\textwidth}
    \dispFig[H]{1}{\textwidth}{Arbre cinématique}{fig_chdaArbreK1}
  \end{column}%
  \end{columns} \pause
	
	\begin{columns}[T]
	\begin{column}{.5\textwidth}\footnotesize
	\begin{alertblock}{équation de mouvement reformulée:}
	  \begin{align}
	  	\begin{bmatrix}
		  H_{11} & H_{12} \\
		  H_{21} & H_{22}
		\end{bmatrix} 
		\cdot
		\begin{bmatrix}
		  \ddot{q}_{1} \\
		  \ddot{q}_{2}
		\end{bmatrix} 
		= 
		\begin{bmatrix}
		  \tau_{1} \\
		  \tau_{2}
		\end{bmatrix} 
		-
		\begin{bmatrix}
		  C_{1} \\
		  C_{2}
		\end{bmatrix} \label{equ_local_eqMvt_2}
		\end{align}
	\end{alertblock}
	\end{column}

	\begin{column}{.5\textwidth}\footnotesize
	\begin{alertblock}{Inconnues rassemblées à gauche:}
		\begin{align}
		\begin{bmatrix}
		  H_{11} & 0 \\
		  H_{21} &  -I
		\end{bmatrix} 
		\cdot
		\begin{bmatrix}
		  \ddot{q}_1 \\
		  \tau_2
		\end{bmatrix} 
		=
		\begin{bmatrix}
		  \tau_1 \\
		  0
		\end{bmatrix} 
		-
		\begin{bmatrix}
		  C'_{1} \\
		  C'_{2}
		\end{bmatrix} \label{equ_equationMvt_dynHyb2} \\
		\notag \\
		{\tiny \textnormal{Avec} \qquad
		\begin{bmatrix}
		  C'_{1} \\
		  C'_{2}
		\end{bmatrix}
		=
		\begin{bmatrix}
		  C_{1} \\
		  C_{2}
		\end{bmatrix}
		+
		\begin{bmatrix}
		  H_{12} \ddot{q}_2 \\
		  H_{22} \ddot{q}_2
		\end{bmatrix}} \label{equ_cPrime}
		\end{align}
	\end{alertblock}
	\end{column}
	\end{columns}
  
\end{frame}

\begin{frame}

  \frametitle{Quatre étapes de résolution...}
  
  % affichage au coin droit supérieur des équations de référence
  \begin{columns}[t]
  \begin{column}{.6\textwidth}
    equ.\eqref{equ_equationMvt_dynHyb2} Se décline en 2 lignes... \bigskip \\
    \begin{enumerate}
    \item <3-> calcul de $\boldsymbol{C'}$
    \item <3-> calcul de $H_{11}$
    \item <1-> ${\eqref{equ_equationMvt_dynHyb2} \implies H_{11} \bsy{\ddot{q}_1 = \tau_1 - C'_1}}$ \\
    $\hookrightarrow$ résoudre $\ddot{q}_1$
    \item <2-> $\eqref{equ_equationMvt_dynHyb2} \implies \bsy{\tau_2 = C'_2} + H_{21} \bsy{\ddot{q}_1}$
    \end{enumerate}
  \end{column}
  \begin{column}{.37\textwidth}
  	\begin{block}{équations de mouvement reformulées:}\tiny
	  \begin{align*}
	  	\begin{bmatrix}
		  H_{11} & H_{12} \\
		  H_{21} & H_{22}
		\end{bmatrix} 
		\cdot
		\begin{bmatrix}
		  \ddot{q}_{1} \\
		  \ddot{q}_{2}
		\end{bmatrix} 
		&= 
		\begin{bmatrix}
		  \tau_{1} \\
		  \tau_{2}
		\end{bmatrix} 
		-
		\begin{bmatrix}
		  C_{1} \\
		  C_{2}
		\end{bmatrix} \quad \eqref{equ_local_eqMvt_2} \\
		\notag \\
		\begin{bmatrix}
		  H_{11} & 0 \\
		  H_{21} &  -I
		\end{bmatrix} 
		\cdot
		\begin{bmatrix}
		  \ddot{q}_1 \\
		  \tau_2
		\end{bmatrix} 
		&=
		\begin{bmatrix}
		  \tau_1 \\
		  0
		\end{bmatrix} 
		-
		\begin{bmatrix}
		  C'_{1} \\
		  C'_{2}
		\end{bmatrix} \quad \eqref{equ_equationMvt_dynHyb2} \\
		\end{align*}
	\end{block}
  \end{column}
  \end{columns}

\end{frame}

%\begin{frame}
%  \frametitle{Calcul des coefficients...}
%  
%(garder au coin haut supérieur les 2 équations de mouvement)
%
%Calcul de $C'$: 
%\begin{align*}
%\textnormal{Pour} \quad \ddot{q}=
%\begin{bmatrix}
%  0 \\
%  \ddot{q}_2
%\end{bmatrix}
%: 
%&\left{
%\eqref{equ_equationMvt_dynHyb2}
%\iff
%\begin{bmatrix}
%  C'_1 \\
%  C'_2
%\end{bmatrix}
%=
%\begin{bmatrix}
%  \tau_1 \\
%  \tau_2
%\end{bmatrix} \\
%\eqref{equ_equationMvt_dynHyb1}
%\iff
%\begin{bmatrix}
%  C'_1 \\
%  C'_2
%\end{bmatrix}
%=
%Q \mathrm{ID} \left( q,\dot{q},Q^T
%\begin{bmatrix}
%  0 \\
%  \ddot{q}_2
%\end{bmatrix} \right)
%\right.
%\iff
%&\begin{bmatrix}
%  C'_1 \\
%  C'_2
%\end{bmatrix}
%=
%Q \mathrm{ID} \left( q,\dot{q},Q^T
%\begin{bmatrix}
%  0 \\
%  \ddot{q}_2
%\end{bmatrix} \right)
%\end{align*}
%
%Calcul de $H_{11}$ sous-matrice de $H$
%  - calcul de $H = \mathrm{CRBA}(modèle,q)$
%  - permutation $H' = Q H Q^T$
%  - sélection de $H_{11}$ (méthode d'accès par blocs de la classe \verb;Eigen::Matrix; => \verb;H'.block<n_{fd},n_{fd};)
%
%\end{frame}
%
%\begin{frame}
%  \frametitle{Résolution des équations...}
%  
%Résoudre $\ddot{q}_1$ \\
%  Système linéaire: $H_{11} \ddot{q}_1 = \tau_1 - C'_1$
%  Inversion de $H$ trop coûteuse (complexité $O(n^3)$ (où n est la dimension de $H$)
%  => décomposition de $H$
%  
%Choix de la décomposition:
%  $H$ et $H_{11}$ symétriques, définies positives 
%  [tableau avec complexité des diff. méthodes]
%\setlength{\intextsep}{0pt}
%\setlength{\columnsep}{0cm}
%\begin{wraptable}[7]{r}{0.45\textwidth}\raggedleft
%\begin{tabular}[H]{|l|c|}
%\hline
%Décomposition ou méthode & Complexité $O$ \\ \hline \hline
%inversion directe de matrice & $O(n^3)$ \\ \hline
%LLT et LDLT & $O(n^3/3)$ \\ \hline
%LU & $O(2n^3/3)$ \\ \hline
%QR & $O(4n^3/3)$ \\
%\hline
%\end{tabular}
%\end{wraptable}
%  => factorisation LDL^T (robuste, rapide, la plus appropriée):
%  $H_{11} = L D L^T$
%  ($D$ matrice diagonale,
%   $L$ matrice triangulaire inférieure et $\forall i: L_{ii}=1$)
%  Solveur \verb;Eigen::LDLT;
%
%Calcul de $\tau_2$:
%  Sélection de $H_{21}$ dans  $H'$
%  $\tau_2 = C'_2 + H_{21} \ddot{q}_1$
%
%\end{frame}
%
%\begin{frame}
%  \frametitle{Algorithme complet:}
%  
%  <algo 3.1.1>
%  
%\end{frame}
%==========================================================

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}
%==========================================================

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}
%==========================================================

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}
%==========================================================

%==========================================================

\subsection{Optimisations}

%==========================================================
\section{Méthodes}

\subsection{Méthodes de développement et de validation}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}

%==========================================================

\subsection{Outils de développement}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}

%==========================================================

\section{Conclusion et perspectives}

\begin{frame}
  \frametitle{}
  \framesubtitle{}
\end{frame}


\end{document}
